(function(){function m(){chrome.storage.local.get("news",function(c){c&&c.news&&(a=JSON.parse(c.news))})}function f(){chrome.storage.local.set({news:JSON.stringify(a)})}function g(){try{var c=new XMLHttpRequest,d="http://awe-api.acestream.me/news/get?locale="+chrome.i18n.getMessage("@@ui_locale")+"&_="+Math.random();c.open("GET",d,!0);c.timeout=1E4;c.onreadystatechange=function(){if(4==c.readyState&&200==c.status)try{var d=!1,b=JSON.parse(c.responseText),e;for(e in b)a[e]||(a[e]=b[e],a[e].read=!1,
d=!0);for(e in a)b[e]||(delete a[e],d=!0);d&&f()}catch(h){console.log("news:check: error: "+h)}};c.send()}catch(k){console.log("checkEngine: error: "+k)}window.setTimeout(g,144E5)}var l=!1,a={};Registry.register("news","58",{init:function(){l||(l=!0,m(),g())},getNewsForUrl:function(c){var d,k=[],b;for(b in a)if(!a[b].read){var e=!1;if(a[b].includes&&a[b].includes.length)for(d=0;d<a[b].includes.length;d++){var h=new RegExp(a[b].includes[d]);if(h.test(c)){e=!0;break}}else if(a[b].excludes&&a[b].excludes.length)for(e=
!0,d=0;d<a[b].excludes.length;d++)if(h=new RegExp(a[b].excludes[d]),h.test(c)){e=!1;break}if(e){e=!0;if(a[b].excludeScripts&&a[b].excludeScripts.length){var f=Registry.get("storage"),g={};f.listValues().forEach(function(a){if(a.match("^"+rea.FEATURES.CONSTANTS.PREFIX.META)){a=f.getValue(a);var b="";a.namespace&&(b=a.namespace+"/");b+=a.name;g[b]=1}});for(d=0;d<a[b].excludeScripts.length;d++)if(1===g[a[b].excludeScripts[d]]){e=!1;break}}e&&k.push({id:b,title:a[b].title,text:a[b].text,btnUrl:a[b].btnUrl,
btnTitle:a[b].btnTitle})}}return k},markAsRead:function(c){a[c]&&!a[c].read&&(a[c].read=!0,f())}})})();
