(function(){"use strict";var r=function(){this.net=new u(this);this.videos=new t;this.status=!0;this.mediaPlay=-1;this.newVideos=0;this.load=function(){var n=this;chrome.storage.local.get(function(t){n.videos.list=t.videos!==undefined?t.videos:[];n.status=t.status!==undefined?t.status:!0;n.refreshIcone();n.net.requestListeners()})};this.save=function(){this.saveStatus();this.saveVideos()};this.saveVideos=function(){var n={videos:this.videos.list};chrome.storage.local.set(n)};this.invertCurrenctStatus=function(){this.saveStatus(!this.status)};this.saveStatus=function(n){n!=undefined&&(this.status=n);this.refreshIcone();this.net.requestListeners();var t={status:this.status};chrome.storage.local.set(t)};this.refreshIcone=function(){this.status?(chrome.browserAction.setIcon({path:"icons/movie-on.png"}),chrome.browserAction.setTitle({title:chrome.i18n.getMessage("enable")})):(chrome.browserAction.setIcon({path:"icons/movie-off.png"}),chrome.browserAction.setTitle({title:chrome.i18n.getMessage("disable")}))};this.resetBadge=function(){this.newVideos=0;chrome.browserAction.setBadgeText({text:""})};this.saveLink=function(n,t,i){this.videos.add(n,t,i)!=-1&&(this.saveVideos(),this.newVideos++,chrome.browserAction.setBadgeText({text:""+this.newVideos}))};this.saveLinkVideo=function(n,t,i,r){this.videos.addVideo(n,t,i,r)!=-1&&(this.saveVideos(),this.newVideos++,chrome.browserAction.setBadgeText({text:""+this.newVideos}))};this.sendRequest=function(n){this.net.sendRequest(this.videos.getUrl(n))};this.sendRequest=function(n,t,i){this.net.sendRequest(this.videos.getUrl(n),t,i)};this.getUrlMedia=function(n,t){return this.videos.getUrlMedia(n,t)};this.updateTitleVideo=function(n,t){var i=this.videos.get(n);i.title=t;this.saveVideos()}},t=function(){var t=new i;this.list=[];this.add=function(n,i,r){if(n!=undefined&&i!=null){n=t.getVideoTitle(n);var u=t.regExpVideo.exec(i),f="";if(u.length>2)return f=u[2],this.addVideo(n,i,f,r)}return-1};this.addVideo=function(i,r,u,f){var o,e,s,h;if(i!=undefined&&r!=null){for(i=t.getVideoTitle(i),o=this.list.length,e=this.list.length-1;e>=0;e--)this.list[e].title==i&&this.list.splice(e,1);if(s=(new Date).valueOf(),h=new n(i,r,s,u,f),this.list.push(h),this.list.length>o)return 1}return-1};this.isVideo=function(n){return t.isVideo(n)};this.delete=function(n){for(var t=0;t<this.list.length;t++)if(this.list[t].id==n)return this.list.splice(t,1),t;return-1};this.get=function(n){if(n>0)for(var t=0;t<this.list.length;t++)if(this.list[t].id==n)return this.list[t];return null};this.getUrl=function(n){var t=this.get(n);return t!=null?t.url:""};this.getUrlByIndex=function(n){return this.list.length>n?this.list[n].url:""};this.length=function(){return this.list.length};this.getUrlMedia=function(n,i){var r=this.getUrl(n);return i===!0?r:t.getVideoUrl(r)}},i=function(){this.expTitleSub=[" "+String.fromCharCode(187)+" film "," streaming "];this.regExpVideo=new RegExp("^(.+\\.((mp4)|(webm)|(flv)|(flv)))(?:(\\?.+)?)$");this.regExpExcludeVideo=new RegExp("(ping.chartbeat.net)");this.isVideo=function(n){return this.regExpVideo.test(n)?this.regExpExcludeVideo.test(n)?!1:!0:!1};this.getVideoUrl=function(n){var i=n,t=this.regExpVideo.exec(n);return t!=null&&t.length>1&&(i=t[1]),i};this.getVideoTitle=function(n){for(var i,r=n,u=n.toLowerCase(),t=0;t<this.expTitleSub.length;t++)if(i=u.indexOf(this.expTitleSub[t]),i>0){r=n.substring(0,i);break}return r}},n=function(n,t,i,r,u){this.title=n;this.url=t;this.id=i;this.type=r;this.origin=u},u=function(n){var o=new i,t=n,u="http://localhost:8080",s="/requests/status.json?command=in_play&input=",h=new f,c=new e,r;this.sendRequest=function(n,t,i){var r=new XMLHttpRequest;n==""?r.open("GET",u):r.open("GET",u+s+encodeURIComponent(n));r.onreadystatechange=function(){r.readyState==4&&(t=t||onError,i=i||onSuccess,r.status!=200?t(r):i(r))};r.send()};this.showResponse=function(){};this.onSuccess=function(){this.errorVlc=!1};this.onError=function(){this.errorVlc=!0};this.requestListeners=function(){t.status?(chrome.webRequest.onBeforeRequest.hasListeners()||chrome.webRequest.onBeforeRequest.addListener(this.processRequest,{urls:["<all_urls>"],types:["object","other"]}),chrome.tabs.onUpdated.hasListeners()||chrome.tabs.onUpdated.addListener(this.tabListener)):(chrome.webRequest.onBeforeRequest.hasListeners()&&chrome.webRequest.onBeforeRequest.removeListener(this.processRequest),chrome.tabs.onUpdated.hasListeners()&&chrome.tabs.onUpdated.removeListener(this.tabListener))};this.processRequest=function(n){t.status&&n.tabId>-1&&o.isVideo(n.url)&&chrome.tabs.get(n.tabId,function(i){i.url.lastIndexOf("chrome-extension:",0)!==0&&t.saveLink(i.title,n.url,i.url)})};this.tabListener=function(n,i,u){t.status&&u.url.lastIndexOf("chrome-extension:",0)!==0&&u.url!=u.title&&(h.saveVideo(u.url,r),c.saveVideo(u.url,r))};r=function(n){t.saveLinkVideo(n.title,n.url,n.type,n.origin)}},f=function(){var i=new RegExp("^http[s]{0,1}://www.dailymotion.com/video/([^_]+)_.+$"),r=new RegExp("^http[s]{0,1}://www.dailymotion.com/playlist/.+#video=(.+)$"),f=function(n){return i.test(n)?!0:r.test(n)?!0:!1},t,u;this.saveVideo=function(n,u){var e,o;f(n)&&(e=i.exec(n),e!=null?e.length>1&&t(e[1],n,u):(o=r.exec(n),o!=null&&o.length>1&&t(o[1],n,u)))};t=function(n,t,i){var r=new XMLHttpRequest,f=u;r.open("GET","http://www.dailymotion.com/json/video/"+n+"?fields=title,url,stream_h264_hd1080_url,stream_h264_hd_url,stream_h264_hq_url,stream_h264_url,stream_h264_sd_url",!0);r.onreadystatechange=function(){if(r.readyState==4&&r.status==200&&r.responseText&&i!=undefined){var n=f(r.responseText);i(n)}};r.send(null)};u=function(t){var i=JSON.parse(t),u=i.title,f=i.url,r="";return i.stream_h264_hd1080_url!=null?r=i.stream_h264_hd1080_url:i.stream_h264_hd_url!=null?r=i.stream_h264_hd_url:i.stream_h264_hq_url!=null?r=i.stream_h264_hq_url:i.stream_h264_url!=null?r=i.stream_h264_url:i.stream_h264_sd_url!=null&&(r=i.stream_h264_sd_url),new n(u,r,"0","mp4",f)}},e=function(){var i=new RegExp("^http[s]{0,1}://www.youtube.com/watch\\?v=(.+)$"),r=function(n){return i.test(n)?!0:!1};this.saveVideo=function(n,t){if(r(n)){var f=i.exec(n);f!=null&&f.length>1&&u(f[1],n,t)}};var u=function(n,t,i){var r=new XMLHttpRequest,u=f;r.open("GET","https://www.youtube.com/get_video_info?video_id="+n+(t?"&eurl="+encodeURIComponent(t):"")+"&el=detailpage&ps=default&gl=US&hl=en",!0);r.onreadystatechange=function(){if(r.readyState==4&&r.status==200&&r.responseText&&i!=undefined){var n=u(r.responseText);n!=undefined&&(n.origin=t,i(n))}};r.send()},e=function(i){var e,v,o,u,y,s,h,p,w,c,l,f;i="&"+i;var r={},b='"url_encoded_fmt_stream_map": "',k='"',a=t(i,'"title": "',k);if(a=decodeURIComponent(a.replace(/\+/g,"%20")),i.indexOf(b)!=-1)for(e=t(i,b,k),e=e.replace(/\\\//g,"/").replace(/\\u0026/g,"&"),v=decodeURIComponent(e).split(","),o=0;o<v.length;o++){for(u={},y=v[o].split("&"),s=0;s<y.length;s++)h=y[s].split("="),h.length>1&&(u[h[0]]=h[1]);var d=u.sparams,g=u.url,nt=u.s,tt=u.itag,it=u.mime;if(d!=undefined&&g!=undefined&&nt!=undefined&&tt!=undefined&&it!=undefined&&it.indexOf("mp4")!=-1){for(p=g.split("?")[0],w=decodeURIComponent(d).split(","),c=0;c<w.length;c++)l=w[c],u[l]!=undefined&&(p+="&"+l+"="+u[l]);r[tt]=p+"&signature="+nt}}return f="",r["38"]?f=r["38"]:r["37"]?f=r["37"]:r["22"]?f=r["22"]:r["18"]&&(f=r["18"]),new n(a,f,"0","mp4","")},t=function(n,t,i){var r="";return n.indexOf(t)!=-1&&(r=n.substring(n.indexOf(t)+t.length),r.indexOf(i)!=-1&&(r=r.substring(0,r.indexOf(i)))),r},f=function(i){var v,h,o,y,c,p,f,u,e;i="&"+i;var r={},l="&url_encoded_fmt_stream_map=",a="&",s=t(i,"&title=",a);if(s=decodeURIComponent(s.replace(/\+/g,"%20")),i.indexOf(l)!=-1)for(v=t(i,l,a),h=decodeURIComponent(v).split(","),o=0;o<h.length;o++){for(f=h[o].split("&"),u=0;u<f.length;u++)f[u].substring(0,4)=="itag"?y=f[u].substring(5):f[u].substring(0,3)=="url"?c=decodeURIComponent(f[u].substring(4)):f[u].substring(0,3)=="sig"&&(p=decodeURIComponent(f[u].substring(4)));c+="&signature="+p;r[y]=c}return e="",r["38"]?e=r["38"]:r["37"]?e=r["37"]:r["22"]?e=r["22"]:r["18"]&&(e=r["18"]),new n(s,e,"0","mp4","")}};chrome.videoCast=chrome.videoCast||{};chrome.videoCast.storage=r;chrome.videoCast.videos=t})();var helper=window.helper||{};helper.store=null;helper.loadStore=function(){return helper.store==null&&(helper.store=new chrome.videoCast.storage,helper.store.load()),helper.store};(chrome.storage&&chrome.storage.local&&helper.loadStore(),chrome.runtime&&chrome.runtime.onStartup)?chrome.runtime.onStartup.addListener(function(){helper.loadStore()}):chrome.windows.onCreated.addListener(function(){helper.loadStore()});